{% extends "base.html" %}

{% load url from future %}
{% load hk_generic %}
{% load gravatar %}
{% load storm %}


{% block title %}
{{ mlist.display_name|default:mlist.name|escapeemail }} - {{ app_name|title }}
{% endblock %}


{% block content %}

<div class="container">

{% include 'threads/month_list.html' %}

    <div id="overview" class="col-md-10">
	
	<div id="highlights" class="col-md-3">
	    <div id="breadcrumb" class="row">
			{% if view_name != 'all_lists' %}
			<a href="{% url 'root' %}" class="root">
			{% endif %}
			All lists 
			{% if view_name != 'all_lists' %}
			</a>
			{% endif %}
			<h1>{{ mlist|shorten_list_name }}</h1>
			<p id="description">{{ mlist.description}}</p>
	    </div>
		<div class="thread-new row">
			<a href="{% url "message_new" mlist_fqdn=mlist.name %}"
			class="btn btn-default{% if not user.is_authenticated %} disabled" title="You must be logged-in to create a thread.{% endif %}">
			<i class="fa fa-plus"></i> Start a new thread</a>
		</div>
		
	    <section id="statistics" class="row">
			<h3>Activity Summary</h3>
			<div id="chart">
				<p id="chart-caption" class="caption">Post volume over the past <strong>30</strong> days.</p>			
			</div>
			<p class="duration-text">In the past <strong>30</strong> days:</p>			
			<ul class="list-stats">
				<li><i class="fa fa-user participant"></i> {{ num_participants }} participants</li>
				<li><i class="fa fa-comment discussion"></i> {{ num_threads }} discussions</li>
			</ul>
		</section>

		<section id="discussion-maker" class="row">
			<h3>Most active posters</h3>
			{% for poster in top_posters %}
			<div class="maker row">
				<div class="maker-id col-md-1">
					#{{forloop.counter}}
				</div>
				<div class="gravatar col-md-2">
					{% gravatar poster.email 40 %}
					<br />
				</div>
				<div class="maker-details col-md-8">
					<span class="maker-name">{{ poster.name }}</span>
					<br />
					<span class="score">{{ poster.count }}</span> posts
				</div>
			</div>
			{% endfor %}
		</section>

		<!--  <div id="fig"></div> -->
	</div>

	<div id="discussions" class="col-md-9 pull-right">
		<section id="most-active">
		    <h3>Recently active discussions</h3>
		    {% for thread in most_active_threads %}
			{% include "threads/summary_thread.html"  %} <!-- cut - with counter=forloop.counter -->
		    {% endfor %}
		</section>

		<section id="popular-threads">
		    <h3>Most popular discussions</h3>
		    {% for thread in pop_threads %}
			{% include "threads/summary_thread.html" with counter=forloop.counter %}
		    {% empty %}
			<p>No vote has been cast this month (yet).</p>
		    {% endfor %}
		</section>

		<section id="top-discussion">
                <h3>Most active discussions</h3>
                {% for thread in top_threads %}
                    {% include "threads/summary_thread.html" with counter=forloop.counter %}
                {% endfor %}
            </section>

            <section id="discussion-by-category">
                <h3>Discussion by category</h3>
                {% for category, threads in threads_by_category.items %}
                    <h4 class="label{% if forloop.first %} first{% endif %}"
                       style="background-color:{{category.color}}"
                       >{{ category.name|upper }}
                    </h4>
                    <ul>
                    {% for thread in threads %}
                        <li>{% include "threads/summary_thread.html" %}</li>
                    {% endfor %}
                    </ul>
                {% empty %}
                    <p>No category has been set this month (yet).</p>
                {% endfor %}
            </section>

            {% if top_author %}
            <section id="discussion-maker">
                <h3>Prominent discussion maker</h3>
                {% for author in top_author %}
                <!-- Start discussion maker -->
                <div class="maker">
                    <div class="inline-block maker-id">
                        #{{forloop.counter}}
                    </div>
                    <div class="inline-block gravatar">
                        {% if author.email %}
                        {% gravatar author.email 40 %}
                        <br />
                        {% endif %}
                    </div>
                    <div class="inline-block">
                        <span class="maker-name">{{author.name}}</span>
                        <br />
                        <span class="score">+{{author.kudos}}</span> kudos
                    </div>
                </div>
                <!-- End discussion maker -->
                {% endfor %}

                <h3>Tag cloud</h3>
            </section>
            {% endif %}

	</div>

    </div>

</div>

{% endblock %}

{% block additionaljs %}

<script type="text/javascript" >
/*   
    $(function() {
        activity_graph(
            "#fig",
            ["{{days|join:'","'}}"],
            {{evolution}},
            "{{ archives_baseurl }}"
        )
    });
*/
    
    $(function() {
	chart(
	    "#chart",
	    ["{{days|join:'","'}}"],
            {{evolution}},
            "{{ archives_baseurl }}",
            "#chart-caption"
	)
    });
</script>

{% endblock %}
